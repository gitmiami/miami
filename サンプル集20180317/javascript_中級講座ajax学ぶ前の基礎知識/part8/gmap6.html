<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<title>地図に表示する場所を住所で指定する</title>
<script type="text/javascript" src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAvVPx2fXHMvcxAcTMsb0-_xQiwruuphwe_8_hK3_65QRBvTL3zxTwTuKiC-CTtDsWpAzry_7padvzUA"></script>
<script type="text/javascript">
//<![CDATA[
var map;
var marker;
var geocoder;

window.onload = function() {
    if (GBrowserIsCompatible()) {
        // GMap2オブジェクトのインスタンスを作成する
        map = new GMap2(document.getElementById("gmap"));
        // 地図にコントロールを追加する
        map.addControl(new GLargeMapControl());
        map.addControl(new GScaleControl());
        map.addControl(new GMapTypeControl());
        map.addControl(new GOverviewMapControl());
        // GClientGeocoderオブジェクトのインスタンスを作成する
        geocoder = new GClientGeocoder();
    }
};

function showMap() {
    if (GBrowserIsCompatible()) {
        // 住所から緯度と経度を割り出す
        geocoder.getLatLng(
            document.mapinfo.address.value,
            function(point) {
                // 緯度／経度を割り出せなかった場合
                if (!point) {
                    alert(point + " その住所は見つかりません");
                }
                // 緯度／経度を割り出せた場合
                else {
                    // 地図を表示する
                    map.setCenter(point, 15);
                    // すでにマーカーがついていれば、それを削除する
                    if (marker) {
                        map.removeOverley(marker);
                    }
                    // マーカーを作成する
                    var marker = new GMarker(point);
                    // マーカーがクリックされたときに、
                    // 地図の中心の住所を情報ウィンドウを表示するようにする
                    GEvent.addListener(marker, "click", function() {
                        marker.openInfoWindowHtml('<p>' + document.mapinfo.address.value + '</p>')
                    });
                    // 地図にマーカーを表示する
                    map.addOverlay(marker);
                }
            }
        );
    }
}

window.onunload = GUnload;
//]]>
</script>
</head>
<body>
<form name="mapinfo" method="get" action="">
住所 <input type="text" name="address" size="50" />
<input type="button" value="表示" onclick="showMap();" />
</form>
<div id="gmap" style="width : 800px; height : 600px;"></div>
</body>
</html>
