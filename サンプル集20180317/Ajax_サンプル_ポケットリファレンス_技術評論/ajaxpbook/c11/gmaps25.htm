<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
xmlns:v="urn:schemas-microsoft-com:vml">
<meta http-equiv="Content-Type" 
content="text/html; charset=UTF-8" />
<head><title>for Ajax</title>
<style type="text/css">
v\:* {
behavior:url(#default#VML);
}
</style>
<!-- 下記キーは、必ず自分専用のものをhttp://www.google.com/apis/maps/で取得して使ってください -->
<script src="http://maps.google.com/maps?file=api&v=2&key=ABQIAAAAAO-r1bqRz2fZr-QmjsewWxTBG40DOe0T0nk6eHQpxKakXljMXBRC2TQok7m4oJbtwLNiVRFOqxftEg" type="text/javascript"></script>
<script type="text/javascript" src="../../lib/funcs.js"></script>
<script type="text/javascript">
//<![CDATA[
var latlontime = [];
  latlontime[0] = { lon:+140.04032 ,lat:+35.96078 ,time:20050909072341 } ;
  latlontime[1] = { lon:+140.04398 ,lat:+35.96361 ,time:20050909072441 } ;
  latlontime[2] = { lon:+140.04684 ,lat:+35.96578 ,time:20050909072519 } ;
  latlontime[3] = { lon:+140.04872 ,lat:+35.97020 ,time:20050909072601 } ;
  latlontime[4] = { lon:+140.05187 ,lat:+35.97406 ,time:20050909072634 } ;
  latlontime[5] = { lon:+140.05463 ,lat:+35.97789 ,time:20050909072710 } ;
  latlontime[6] = { lon:+140.05685 ,lat:+35.97810 ,time:20050909072735 } ;
  latlontime[7] = { lon:+140.06046 ,lat:+35.97776 ,time:20050909072759 } ;
  latlontime[8] = { lon:+140.06542 ,lat:+35.97704 ,time:20050909072827 } ;
  latlontime[9] = { lon:+140.07174 ,lat:+35.97644 ,time:20050909072904 } ;
  latlontime[10] = { lon:+140.07659 ,lat:+35.97503 ,time:20050909072937 } ;
  latlontime[11] = { lon:+140.08368 ,lat:+35.97297 ,time:20050909073014 } ;
  latlontime[12] = { lon:+140.08744 ,lat:+35.97312 ,time:20050909073044 } ;
  latlontime[13] = { lon:+140.09170 ,lat:+35.97312 ,time:20050909073108 } ;
  latlontime[14] = { lon:+140.09855 ,lat:+35.97309 ,time:20050909073151 } ;
  latlontime[15] = { lon:+140.10104 ,lat:+35.97514 ,time:20050909073230 } ;
  latlontime[16] = { lon:+140.10434 ,lat:+35.97956 ,time:20050909073324 } ;
GLatLng_tky = function (la,ln){
  var lat = la - la * 0.00010695  + ln * 0.000017464 + 0.0046017;
  var lng = ln - la * 0.000046038 - ln * 0.000083043 + 0.010040;
  return new GLatLng(lat,lng);
}
  //ロード完了チェック
var  loaded = false
function initOnLOad(){ 
  document.getElementById("button1").value="アニメーション開始"
  loaded = true; 

  //基本指定
  var map = new GMap2(document.getElementById("map"));
  map.addControl(new GLargeMapControl());
  //スタート位置を最初に表示
  map.setCenter(new GLatLng_tky(latlontime[0].lat,latlontime[0].lon),13);
  var points = [];  //ポリラインポイント
  var time   = 0 ;  //描画インターバル
  //アイコン作成
  var icon = new GIcon();
  icon.image = "./yazirusi.png";
  icon.shadow = "./shadow.png";
  icon.iconSize = new GSize(20, 34);
  icon.shadowSize = new GSize(37, 34);
  icon.iconAnchor = new GPoint(10,34);
}
  //ライン描画
function writePLine(){
  if(!loaded) return
  //初期位置
  map.setCenter(new GLatLng_tky(latlontime[0].lat,latlontime[0].lon),13);
  map.clearOverlays()
  //start icon描画
  window.setTimeout("writeIcon()",time);
  //ポリライン描画ポイントとタイマーを生成
  for (i=0 ; i < latlontime.length ; i++){
  lat =  latlontime[i].lat
  lon =  latlontime[i].lon
  setTimer(lon,lat,time);
  time += 1000 //1秒間隔で描画する
  }
  //end icon描画
  window.setTimeout("writeIcon()",time);
  }
  //アイコン描画
function writeIcon(){
  var marker = new GMarker(map.getCenter(), icon);
  map.addOverlay(marker);
}
//ポリライン描画タイマーを生成
function setTimer(lon,lat,time){
  window.setTimeout(
  	function() {
  		points.push(new GLatLng_tky(lat,lon));
  		map.panTo(
  			new GLatLng_tky(lat,lon)
  		);
  		map.addOverlay(new GPolyline(points,'#ff00ff',5,0.7));
  	}, time);
  }
}
setListener(window, "load", initOnLoad);
//]]>
</script>
</head>
<body>
<input name="button1" id="button1" type="button" onclick="writePLine()" value="少しお待ちください... " />
<div id="map" style="width: 500px; height: 400px"></div>
</body>
</html>
