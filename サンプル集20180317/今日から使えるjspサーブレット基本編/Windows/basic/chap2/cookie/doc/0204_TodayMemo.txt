■「今日の一言」を掲載したい


先頭ページに、ちょっとした伝言板があれば、なにかと便利なものです。
イントラネット上のサイトであれば過去の主なニュースを書きこんでおいたり、インターネット上のサイトであれば近日中のお知らせなどを表示したり…とシンプルでありながら、さまざまな使い方が考えられます。
ここでは、そんなニーズに答えて、別個に用意した複数のテキストファイルの内容をテキストエリアにランダムに表示する、簡易伝言板を紹介します。
もちろん、HTML上に直接書きこんでも、なにも問題はないのですが、頻繁に差し替えるものですから、別個にテキストファイルなどで保存しておいた方が、はるかに管理しやすいでしょう。

●ポイント
　前項の「スクリプトのソースコードを公開したい」の応用です。
　前回はクエリ情報で読み出すテキストを指定していましたが、今度はテキストファイルにあらかじめ連番をつけておいた上で、スクリプトからランダムに数値を発生させることで、読み出すべきファイルを特定することにします。

●サンプル
□txtfmt.asp
1	<%@Language="VBScript" %>
2	<html>
3	<head>
4	<title>今日の一言</title>
5	</head>
6	<body>
7	<h1>あなたに捧げる今日の一言</h1>
8	<form>
9	<textarea rows="15" cols="70">
10	<%
11	Randomize
#　乱数を初期化します。乱数を呼び出す場合は、かならずこのRandomizeステートメントをあらかじめ実行しておく必要があります。
12	strPath="./article/book" & Int(5*Rnd+1) & ".txt"
#　Rnd関数で1〜5の乱数を生成し（Int(5*Rnd+1)）、呼び出すテキストファイルへの相対パスを生成します。
#　変数strPathには、たとえば"./article/book1.txt"のような文字列が格納されます。
13	Set fs=Server.CreateObject("Scripting.FileSystemObject")
#　FileSystemObjectオブジェクトを生成します。
14	Set ts=fs.OpenTextFile(Server.MapPath(strPath),1)
#　12行目で生成されたパスを読み込みます。OpenTextFileメソッドの第二引数で指定された1は、ファイルを読み取り専用で開くことを示します。
#　変数tsには、指定されたファイルを示すTextStreamオブジェクトが格納されます。
15	Do While Not ts.AtEndOfStream
16	　Response.Write ts.ReadLine & Chr(13) & Chr(10)
17	Loop
#　テキストファイルを最終行（ts.AtEndOfStreamがTrue）になるまで、1行ずつ読みこみます。各行の末尾には、改行文字（Chr(13) & Chr(10)）を付加します。
18	%>
19	</textarea>
20	</form>
21	</body>
22	</html>

●TIPS
△範囲を指定した乱数の生成方法
　Rnd関数は通常0以上1未満の値を返しますが、以下のような構文を用いることで、lngMin〜lngMaxの範囲の整数をランダムに生成することができます。
　Int((lngMax-lngMin+1)*Rnd+lngMin)
　さまざまな局面で汎用的に使える手法でもありますので、是非とも覚えておきたいところです。
